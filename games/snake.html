<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Play Snake - Classic arcade game at Chris's Games">
    <title>Snake - Chris's Games</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        #gameCanvas {
            background: #1a1a2e;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow-glow);
        }

        .game-info {
            display: flex;
            gap: 2rem;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .game-controls {
            margin-top: 1rem;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none;
            margin: 1.5rem auto 0;
            grid-template-columns: repeat(3, 60px);
            gap: 10px;
            width: fit-content;
        }

        .d-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: white;
            font-size: 1.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            touch-action: manipulation;
            /* Prevent zoom/scroll */
        }

        .d-btn:active {
            background: var(--primary-color);
            transform: scale(0.95);
        }

        .d-btn.up {
            grid-column: 2;
        }

        .d-btn.left {
            grid-column: 1;
        }

        .d-btn.down {
            grid-column: 2;
        }

        .d-btn.right {
            grid-column: 3;
        }

        @media (max-width: 768px) {
            .mobile-controls {
                display: grid;
            }

            .game-info {
                font-size: 1rem;
                gap: 1rem;
            }

            #gameCanvas {
                width: 100%;
                max-width: 350px;
                height: auto;
                aspect-ratio: 1/1;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">üéÆ Chris's Games</a>
            <ul class="nav-links">
                <li><a href="../index.html">Main Menu</a></li>
                <li><a href="../about.html">About Me</a></li>
                <li><a href="../games.html">Games</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <section class="page-section">
            <h1 class="section-title">üêç Snake</h1>

            <div class="game-container">
                <div class="game-info">
                    <span>Score: <strong id="score">0</strong></span>
                    <span>High Score: <strong id="highScore">0</strong></span>
                </div>

                <canvas id="gameCanvas" width="400" height="400"></canvas>

                <div class="game-controls">
                    <p>Use <strong>Arrow Keys</strong> or <strong>WASD</strong> to move</p>
                    <p>Press <strong>Space</strong> to start/restart</p>
                </div>

                <!-- Mobile D-Pad -->
                <div class="mobile-controls">
                    <div></div>
                    <button class="d-btn up" id="btnUp">‚¨ÜÔ∏è</button>
                    <div></div>
                    <button class="d-btn left" id="btnLeft">‚¨ÖÔ∏è</button>
                    <button class="d-btn down" id="btnDown">‚¨áÔ∏è</button>
                    <button class="d-btn right" id="btnRight">‚û°Ô∏è</button>
                </div>
            </div>
        </section>
    </main>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const highScoreEl = document.getElementById('highScore');

        const gridSize = 20;
        const tileCount = canvas.width / gridSize;

        let snake = [{ x: 10, y: 10 }];
        let food = { x: 15, y: 15 };
        let dx = 0;
        let dy = 0;
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let gameRunning = false;
        let gameLoop;

        highScoreEl.textContent = highScore;

        function drawGame() {
            // Clear canvas
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            ctx.strokeStyle = 'rgba(99, 102, 241, 0.1)';
            for (let i = 0; i < tileCount; i++) {
                ctx.beginPath();
                ctx.moveTo(i * gridSize, 0);
                ctx.lineTo(i * gridSize, canvas.height);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, i * gridSize);
                ctx.lineTo(canvas.width, i * gridSize);
                ctx.stroke();
            }

            // Draw food
            ctx.fillStyle = '#ec4899';
            ctx.shadowColor = '#ec4899';
            ctx.shadowBlur = 10;
            ctx.beginPath();
            ctx.arc(
                food.x * gridSize + gridSize / 2,
                food.y * gridSize + gridSize / 2,
                gridSize / 2 - 2,
                0,
                Math.PI * 2
            );
            ctx.fill();
            ctx.shadowBlur = 0;

            // Draw snake
            snake.forEach((segment, index) => {
                const gradient = ctx.createLinearGradient(
                    segment.x * gridSize,
                    segment.y * gridSize,
                    (segment.x + 1) * gridSize,
                    (segment.y + 1) * gridSize
                );
                gradient.addColorStop(0, '#6366f1');
                gradient.addColorStop(1, '#8b5cf6');

                ctx.fillStyle = gradient;
                ctx.shadowColor = '#6366f1';
                ctx.shadowBlur = index === 0 ? 15 : 5;
                ctx.fillRect(
                    segment.x * gridSize + 1,
                    segment.y * gridSize + 1,
                    gridSize - 2,
                    gridSize - 2
                );
            });
            ctx.shadowBlur = 0;

            if (!gameRunning) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 24px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('Press SPACE to Start', canvas.width / 2, canvas.height / 2);
            }
        }

        function moveSnake() {
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            // Wrap around walls
            if (head.x < 0) head.x = tileCount - 1;
            if (head.x >= tileCount) head.x = 0;
            if (head.y < 0) head.y = tileCount - 1;
            if (head.y >= tileCount) head.y = 0;

            // Check self collision
            if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                gameOver();
                return;
            }

            snake.unshift(head);

            // Check food collision
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                scoreEl.textContent = score;
                spawnFood();
            } else {
                snake.pop();
            }
        }

        function spawnFood() {
            do {
                food = {
                    x: Math.floor(Math.random() * tileCount),
                    y: Math.floor(Math.random() * tileCount)
                };
            } while (snake.some(segment => segment.x === food.x && segment.y === food.y));
        }

        function gameOver() {
            gameRunning = false;
            clearInterval(gameLoop);

            if (score > highScore) {
                highScore = score;
                localStorage.setItem('snakeHighScore', highScore);
                highScoreEl.textContent = highScore;
            }
        }

        function startGame() {
            snake = [{ x: 10, y: 10 }];
            dx = 1;
            dy = 0;
            score = 0;
            scoreEl.textContent = score;
            spawnFood();
            gameRunning = true;

            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(() => {
                moveSnake();
                drawGame();
            }, 120); // Slightly slower for easier mobile play? Keeping 100 for now.
        }

        // Mobile Button Handlers
        document.getElementById('btnUp').addEventListener('touchstart', (e) => { e.preventDefault(); if (dy !== 1) { dx = 0; dy = -1; } if (!gameRunning) startGame(); });
        document.getElementById('btnDown').addEventListener('touchstart', (e) => { e.preventDefault(); if (dy !== -1) { dx = 0; dy = 1; } if (!gameRunning) startGame(); });
        document.getElementById('btnLeft').addEventListener('touchstart', (e) => { e.preventDefault(); if (dx !== 1) { dx = -1; dy = 0; } if (!gameRunning) startGame(); });
        document.getElementById('btnRight').addEventListener('touchstart', (e) => { e.preventDefault(); if (dx !== -1) { dx = 1; dy = 0; } if (!gameRunning) startGame(); });

        // Also add click for debugging on desktop
        document.getElementById('btnUp').addEventListener('click', () => { if (dy !== 1) { dx = 0; dy = -1; } if (!gameRunning) startGame(); });
        document.getElementById('btnDown').addEventListener('click', () => { if (dy !== -1) { dx = 0; dy = 1; } if (!gameRunning) startGame(); });
        document.getElementById('btnLeft').addEventListener('click', () => { if (dx !== 1) { dx = -1; dy = 0; } if (!gameRunning) startGame(); });
        document.getElementById('btnRight').addEventListener('click', () => { if (dx !== -1) { dx = 1; dy = 0; } if (!gameRunning) startGame(); });

        document.addEventListener('keydown', (e) => {
            // Prevent arrow keys and space from scrolling the page
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
                e.preventDefault();
            }

            if (e.code === 'Space') {
                if (!gameRunning) startGame();
                return;
            }

            if (!gameRunning) return;

            switch (e.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    if (dy !== 1) { dx = 0; dy = -1; }
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    if (dy !== -1) { dx = 0; dy = 1; }
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    if (dx !== 1) { dx = -1; dy = 0; }
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    if (dx !== -1) { dx = 1; dy = 0; }
                    break;
            }
        });

        drawGame();

        // ===== Feedback System =====
        const GAME_ID = 'snake';

        // Load saved data
        let likes = parseInt(localStorage.getItem(`${GAME_ID}_likes`) || '0');
        let dislikes = parseInt(localStorage.getItem(`${GAME_ID}_dislikes`) || '0');
        let userVote = localStorage.getItem(`${GAME_ID}_vote`);
        let comments = JSON.parse(localStorage.getItem(`${GAME_ID}_comments`) || '[]');

        const likeBtn = document.getElementById('likeBtn');
        const dislikeBtn = document.getElementById('dislikeBtn');
        const likeCount = document.getElementById('likeCount');
        const dislikeCount = document.getElementById('dislikeCount');
        const commentsList = document.getElementById('commentsList');

        // Update UI
        function updateFeedbackUI() {
            likeCount.textContent = likes;
            dislikeCount.textContent = dislikes;
            likeBtn.classList.toggle('active', userVote === 'like');
            dislikeBtn.classList.toggle('active', userVote === 'dislike');
            renderComments();
        }

        function toggleLike() {
            if (userVote === 'like') {
                likes--;
                userVote = null;
            } else {
                if (userVote === 'dislike') dislikes--;
                likes++;
                userVote = 'like';
            }
            localStorage.setItem(`${GAME_ID}_likes`, likes);
            localStorage.setItem(`${GAME_ID}_dislikes`, dislikes);
            localStorage.setItem(`${GAME_ID}_vote`, userVote || '');
            updateFeedbackUI();
        }

        function toggleDislike() {
            if (userVote === 'dislike') {
                dislikes--;
                userVote = null;
            } else {
                if (userVote === 'like') likes--;
                dislikes++;
                userVote = 'dislike';
            }
            localStorage.setItem(`${GAME_ID}_likes`, likes);
            localStorage.setItem(`${GAME_ID}_dislikes`, dislikes);
            localStorage.setItem(`${GAME_ID}_vote`, userVote || '');
            updateFeedbackUI();
        }

        function renderComments() {
            commentsList.innerHTML = comments.map(c => `
                <div class="comment">
                    <div class="comment-author">${c.author}</div>
                    <div class="comment-text">${c.text}</div>
                </div>
            `).join('');
        }

        function addComment(e) {
            e.preventDefault();
            const author = document.getElementById('authorName').value.trim();
            const text = document.getElementById('commentText').value.trim();
            if (author && text) {
                comments.unshift({ author, text });
                localStorage.setItem(`${GAME_ID}_comments`, JSON.stringify(comments));
                document.getElementById('authorName').value = '';
                document.getElementById('commentText').value = '';
                renderComments();
            }
        }

        updateFeedbackUI();
    </script>
</body>

</html>