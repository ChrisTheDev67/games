<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Play Memory Match - Test your memory at Chris's Games">
    <title>Memory Match - Chris's Games</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        .difficulty-select {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            padding: 3rem;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }

        .difficulty-select h2 {
            font-size: 1.8rem;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .difficulty-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
        }

        .difficulty-btn {
            padding: 1rem 2rem;
            border: 2px solid var(--border-color);
            background: var(--bg-dark);
            color: var(--text-primary);
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
        }

        .difficulty-btn:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-glow);
            transform: translateY(-2px);
        }

        .difficulty-btn.easy {
            border-color: #10b981;
        }

        .difficulty-btn.easy:hover {
            background: rgba(16, 185, 129, 0.2);
        }

        .difficulty-btn.normal {
            border-color: #3b82f6;
        }

        .difficulty-btn.normal:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .difficulty-btn.medium {
            border-color: #f59e0b;
        }

        .difficulty-btn.medium:hover {
            background: rgba(245, 158, 11, 0.2);
        }

        .difficulty-btn.hard {
            border-color: #ef4444;
        }

        .difficulty-btn.hard:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .difficulty-info {
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-align: center;
            margin-top: 0.25rem;
        }

        .game-area {
            display: none;
        }

        .game-area.active {
            display: block;
        }

        .game-info {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
            font-size: 1.1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .countdown-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .countdown-text {
            font-size: 4rem;
            font-weight: 800;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .memory-grid {
            display: grid;
            gap: 0.75rem;
            justify-content: center;
        }

        .grid-easy,
        .grid-normal {
            grid-template-columns: repeat(4, 1fr);
            max-width: 450px;
        }

        .grid-medium {
            grid-template-columns: repeat(7, 1fr);
            max-width: 630px;
        }

        .grid-hard {
            grid-template-columns: repeat(10, 1fr);
            max-width: 720px;
        }

        .card {
            width: 90px;
            height: 90px;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            transition: all 0.3s ease;
            user-select: none;
        }

        .grid-medium .card {
            width: 80px;
            height: 80px;
            font-size: 1.8rem;
        }

        .grid-hard .card {
            width: 65px;
            height: 65px;
            font-size: 1.5rem;
        }

        .card:hover:not(.flipped):not(.matched) {
            border-color: var(--primary-color);
            transform: scale(1.05);
            box-shadow: var(--shadow-glow);
        }

        .card.flipped {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
        }

        .card.matched {
            background: linear-gradient(135deg, #10b981, #34d399);
            border-color: #10b981;
            cursor: default;
        }

        .card-content {
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .card.flipped .card-content,
        .card.matched .card-content,
        .card.preview .card-content {
            opacity: 1;
        }

        .card.preview {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
        }

        .game-controls {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
        }

        .win-message {
            text-align: center;
            padding: 2rem;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            margin-top: 2rem;
            display: none;
        }

        .win-message.show {
            display: block;
        }

        .win-message h2 {
            color: #10b981;
            margin-bottom: 1rem;
        }

        .current-difficulty {
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">üéÆ Chris's Games</a>
            <ul class="nav-links">
                <li><a href="../index.html">Main Menu</a></li>
                <li><a href="../about.html">About Me</a></li>
                <li><a href="../games.html">Games</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <section class="page-section">
            <h1 class="section-title">üß† Memory Match</h1>

            <div class="game-container">
                <!-- Difficulty Selection -->
                <div class="difficulty-select" id="difficultySelect">
                    <h2>Choose Difficulty</h2>
                    <div class="difficulty-buttons">
                        <div>
                            <button class="difficulty-btn easy" data-difficulty="easy">üòä Easy</button>
                            <p class="difficulty-info">16 cards ‚Ä¢ 3s preview</p>
                        </div>
                        <div>
                            <button class="difficulty-btn normal" data-difficulty="normal">üôÇ Normal</button>
                            <p class="difficulty-info">16 cards ‚Ä¢ 2s preview</p>
                        </div>
                        <div>
                            <button class="difficulty-btn medium" data-difficulty="medium">üò§ Medium</button>
                            <p class="difficulty-info">28 cards ‚Ä¢ 1s preview</p>
                        </div>
                        <div>
                            <button class="difficulty-btn hard" data-difficulty="hard">üíÄ Hard</button>
                            <p class="difficulty-info">60 cards ‚Ä¢ No preview!</p>
                        </div>
                    </div>
                </div>

                <!-- Game Area (hidden until difficulty selected) -->
                <div class="game-area" id="gameArea">
                    <div class="game-info">
                        <span>Level: <strong class="current-difficulty" id="currentDifficulty">Easy</strong></span>
                        <span>Moves: <strong id="moves">0</strong></span>
                        <span>Pairs Found: <strong id="pairs">0</strong> / <span id="totalPairs">8</span></span>
                        <span>Time: <strong id="timer">0:00</strong></span>
                    </div>

                    <div class="memory-grid" id="grid"></div>

                    <div class="game-controls">
                        <button class="btn btn-secondary" id="backBtn">‚Üê Back</button>
                        <button class="btn btn-primary" id="restartBtn">üîÑ New Game</button>
                    </div>

                    <div class="win-message" id="winMessage">
                        <h2>üéâ Congratulations!</h2>
                        <p>You found all pairs in <strong id="finalMoves">0</strong> moves!</p>
                        <p>Time: <strong id="finalTime">0:00</strong></p>
                    </div>
                </div>
            </div>

            <!-- Countdown Overlay -->
            <div class="countdown-overlay" id="countdownOverlay">
                <span class="countdown-text" id="countdownText">MEMORIZE!</span>
            </div>
        </section>
    </main>

    <script>
        // Extended emoji set for harder difficulties
        const allEmojis = [
            'üéÆ', 'üé≤', 'üéØ', 'üé®', 'üé≠', 'üé™', 'üé¨', 'üé§',
            'üé∏', 'üéπ', 'üé∫', 'üéª', 'üèÄ', '‚öΩ', 'üèà', 'üéæ',
            'üçï', 'üçî', 'üçü', 'üå≠', 'üçø', 'üßÅ', 'üç©', 'üç™',
            'üöó', 'üöÄ', '‚úàÔ∏è', 'üöÅ', 'üõ∏', '‚õµ'
        ];

        // Difficulty settings
        const difficulties = {
            easy: { cards: 16, previewTime: 3, emojis: 8 },
            normal: { cards: 16, previewTime: 2, emojis: 8 },
            medium: { cards: 28, previewTime: 1, emojis: 14 },
            hard: { cards: 60, previewTime: 0, emojis: 30 }
        };

        let currentDifficulty = 'easy';
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let totalPairsCount = 8;
        let gameStarted = false;
        let timerInterval;
        let seconds = 0;
        let canFlip = false;

        // DOM elements
        const difficultySelectEl = document.getElementById('difficultySelect');
        const gameAreaEl = document.getElementById('gameArea');
        const gridEl = document.getElementById('grid');
        const movesEl = document.getElementById('moves');
        const pairsEl = document.getElementById('pairs');
        const totalPairsEl = document.getElementById('totalPairs');
        const timerEl = document.getElementById('timer');
        const winMessageEl = document.getElementById('winMessage');
        const finalMovesEl = document.getElementById('finalMoves');
        const finalTimeEl = document.getElementById('finalTime');
        const restartBtn = document.getElementById('restartBtn');
        const backBtn = document.getElementById('backBtn');
        const currentDifficultyEl = document.getElementById('currentDifficulty');
        const countdownOverlayEl = document.getElementById('countdownOverlay');
        const countdownTextEl = document.getElementById('countdownText');
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');

        function shuffle(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function selectDifficulty(difficulty) {
            currentDifficulty = difficulty;
            const settings = difficulties[difficulty];
            totalPairsCount = settings.emojis;

            // Update UI
            currentDifficultyEl.textContent = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
            totalPairsEl.textContent = totalPairsCount;

            // Update grid class for layout
            gridEl.className = 'memory-grid grid-' + difficulty;

            // Show game area, hide difficulty select
            difficultySelectEl.style.display = 'none';
            gameAreaEl.classList.add('active');

            createGame();
        }

        function createGame() {
            const settings = difficulties[currentDifficulty];

            // Reset state
            cards = [];
            flippedCards = [];
            matchedPairs = 0;
            moves = 0;
            seconds = 0;
            gameStarted = false;
            canFlip = false;

            clearInterval(timerInterval);
            movesEl.textContent = '0';
            pairsEl.textContent = '0';
            timerEl.textContent = '0:00';
            winMessageEl.classList.remove('show');

            // Get required emojis for this difficulty
            const gameEmojis = allEmojis.slice(0, settings.emojis);

            // Create pairs
            const pairs = [...gameEmojis, ...gameEmojis];
            const shuffledPairs = shuffle(pairs);

            // Clear grid
            gridEl.innerHTML = '';

            // Create cards
            shuffledPairs.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.index = index;
                card.dataset.emoji = emoji;
                card.innerHTML = `<span class="card-content">${emoji}</span>`;
                card.addEventListener('click', () => flipCard(card));
                gridEl.appendChild(card);
                cards.push(card);
            });

            // Start preview phase
            startPreview();
        }

        function startPreview() {
            const settings = difficulties[currentDifficulty];

            if (settings.previewTime === 0) {
                // Hard mode - no preview
                canFlip = true;
                return;
            }

            // Show all cards
            cards.forEach(card => card.classList.add('preview'));

            // Show countdown overlay
            countdownOverlayEl.classList.add('active');
            countdownTextEl.textContent = 'MEMORIZE!';

            let countdown = settings.previewTime;

            setTimeout(() => {
                const countdownInterval = setInterval(() => {
                    countdownTextEl.textContent = countdown;
                    countdown--;

                    if (countdown < 0) {
                        clearInterval(countdownInterval);
                        countdownOverlayEl.classList.remove('active');

                        // Hide all cards
                        cards.forEach(card => card.classList.remove('preview'));
                        canFlip = true;
                    }
                }, 1000);
            }, 500);
        }

        function startTimer() {
            if (gameStarted) return;
            gameStarted = true;
            timerInterval = setInterval(() => {
                seconds++;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function flipCard(card) {
            if (!canFlip) return;
            if (card.classList.contains('flipped') || card.classList.contains('matched')) return;
            if (flippedCards.length >= 2) return;

            startTimer();

            card.classList.add('flipped');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                moves++;
                movesEl.textContent = moves;
                checkMatch();
            }
        }

        function checkMatch() {
            const [card1, card2] = flippedCards;
            const match = card1.dataset.emoji === card2.dataset.emoji;

            if (match) {
                card1.classList.add('matched');
                card2.classList.add('matched');
                matchedPairs++;
                pairsEl.textContent = matchedPairs;
                flippedCards = [];

                if (matchedPairs === totalPairsCount) {
                    gameWon();
                }
            } else {
                canFlip = false;
                setTimeout(() => {
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    flippedCards = [];
                    canFlip = true;
                }, 1000);
            }
        }

        function gameWon() {
            clearInterval(timerInterval);
            finalMovesEl.textContent = moves;
            finalTimeEl.textContent = timerEl.textContent;
            winMessageEl.classList.add('show');
        }

        function goBack() {
            clearInterval(timerInterval);
            gameAreaEl.classList.remove('active');
            difficultySelectEl.style.display = 'flex';
        }

        // Event listeners
        difficultyBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                selectDifficulty(btn.dataset.difficulty);
            });
        });

        restartBtn.addEventListener('click', createGame);
        backBtn.addEventListener('click', goBack);

        // ===== Feedback System =====
        const GAME_ID = 'memory';

        let likes = parseInt(localStorage.getItem(`${GAME_ID}_likes`) || '0');
        let dislikes = parseInt(localStorage.getItem(`${GAME_ID}_dislikes`) || '0');
        let userVote = localStorage.getItem(`${GAME_ID}_vote`);
        let comments = JSON.parse(localStorage.getItem(`${GAME_ID}_comments`) || '[]');

        const likeBtn = document.getElementById('likeBtn');
        const dislikeBtn = document.getElementById('dislikeBtn');
        const likeCount = document.getElementById('likeCount');
        const dislikeCount = document.getElementById('dislikeCount');
        const commentsList = document.getElementById('commentsList');

        function updateFeedbackUI() {
            likeCount.textContent = likes;
            dislikeCount.textContent = dislikes;
            likeBtn.classList.toggle('active', userVote === 'like');
            dislikeBtn.classList.toggle('active', userVote === 'dislike');
            renderComments();
        }

        function toggleLike() {
            if (userVote === 'like') { likes--; userVote = null; }
            else { if (userVote === 'dislike') dislikes--; likes++; userVote = 'like'; }
            localStorage.setItem(`${GAME_ID}_likes`, likes);
            localStorage.setItem(`${GAME_ID}_dislikes`, dislikes);
            localStorage.setItem(`${GAME_ID}_vote`, userVote || '');
            updateFeedbackUI();
        }

        function toggleDislike() {
            if (userVote === 'dislike') { dislikes--; userVote = null; }
            else { if (userVote === 'like') likes--; dislikes++; userVote = 'dislike'; }
            localStorage.setItem(`${GAME_ID}_likes`, likes);
            localStorage.setItem(`${GAME_ID}_dislikes`, dislikes);
            localStorage.setItem(`${GAME_ID}_vote`, userVote || '');
            updateFeedbackUI();
        }

        function renderComments() {
            commentsList.innerHTML = comments.map(c => `
                <div class="comment">
                    <div class="comment-author">${c.author}</div>
                    <div class="comment-text">${c.text}</div>
                </div>
            `).join('');
        }

        function addComment(e) {
            e.preventDefault();
            const author = document.getElementById('authorName').value.trim();
            const text = document.getElementById('commentText').value.trim();
            if (author && text) {
                comments.unshift({ author, text });
                localStorage.setItem(`${GAME_ID}_comments`, JSON.stringify(comments));
                document.getElementById('authorName').value = '';
                document.getElementById('commentText').value = '';
                renderComments();
            }
        }

        updateFeedbackUI();
    </script>
</body>

</html>